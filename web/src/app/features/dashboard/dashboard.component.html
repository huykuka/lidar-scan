<!-- Header bar: Performance Dashboard title + connected/stale badge -->
<div class="p-6 pb-0">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold text-white">Performance Dashboard</h1>
    <div class="flex items-center gap-3">
      <!-- Connection status indicator -->
      <div class="flex items-center gap-2">
        <div 
          class="w-3 h-3 rounded-full"
          [class]="metricsWebSocketService.connected() ? 'bg-green-500' : 'bg-red-500'"
        ></div>
        <span class="text-sm text-gray-300">
          {{ metricsWebSocketService.connected() ? 'Connected' : 'Disconnected' }}
        </span>
      </div>
      <!-- Stale data warning banner using Synergy Badge -->
      @if (metricsStore.isStale()) {
        <syn-badge 
          variant="warning"
          data-testid="stale-banner"
        >
          Data stale â€” reconnecting...
        </syn-badge>
      }
    </div>
  </div>
</div>

<div class="p-6 space-y-6">
  <!-- Row 1: System panel (full width) -->
  <app-system-panel 
    [systemMetrics]="metricsStore.systemMetrics()"
  />

  <!-- Row 2: DAG Overview panel (2/3 width) + WebSocket panel (1/3 width) -->
  <div class="grid grid-cols-3 gap-6">
    <div class="col-span-2">
      <app-dag-overview-panel
        [nodes]="metricsStore.dagMetrics()?.nodes || []"
        [totalNodes]="metricsStore.dagMetrics()?.total_nodes || 0"
        [runningNodes]="metricsStore.dagMetrics()?.running_nodes || 0"
        (nodeSelected)="onNodeSelected($event)"
      />
    </div>
    <div class="col-span-1">
      <app-websocket-panel
        [wsMetrics]="metricsStore.wsMetrics()"
      />
    </div>
  </div>

  <!-- Row 3: Rendering panel (1/2 width) + DAG Node Detail (1/2 width) -->
  <div class="grid grid-cols-2 gap-6">
    <app-rendering-panel
      [frontendMetrics]="metricsStore.frontendMetrics()"
    />
    <app-dag-node-detail-panel
      [node]="selectedNode"
      (closeDetail)="onCloseDetail()"
    />
  </div>
</div>