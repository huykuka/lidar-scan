<form [formGroup]="form" (ngSubmit)="onSave()" class="flex flex-col">
  <div class="flex flex-col gap-5">
          
          <!-- Identity -->
          <div class="grid grid-cols-2 gap-4">
            <syn-input label="Sensor Name" 
                       placeholder="Front Lidar" 
                       formControlName="name"
                       ngDefaultControl
                       size="small"
                       [helpText]="form.get('name')?.invalid && form.get('name')?.touched ? 'Name is required' : ''">
            </syn-input>

            <div class="flex flex-col justify-center">
              <span class="text-xs font-bold text-syn-typography-color-text mb-2">Operation Mode</span>
              <syn-switch size="small"
                          [checked]="form.get('mode')?.value === 'sim'"
                          (syn-change)="form.get('mode')?.setValue($any($event.target).checked ? 'sim' : 'real')">
                {{ form.get('mode')?.value === 'sim' ? 'Simulation (PCD)' : 'Hardware (Real)' }}
              </syn-switch>
            </div>
          </div>

          <!-- Configuration -->
          <div class="flex flex-col gap-4">
            
            <!-- Real Mode Params -->
            <div *ngIf="form.get('mode')?.value === 'real'" class="flex flex-col gap-4 animate-in slide-in-from-top-2 duration-300">
              <div class="grid grid-cols-2 gap-4">
                <syn-input label="Lidar Hostname" 
                           placeholder="192.168.1.123" 
                           formControlName="hostname"
                           ngDefaultControl
                           size="small"
                           [helpText]="form.get('hostname')?.invalid && form.get('hostname')?.touched ? 'Invalid IP' : ''">
                </syn-input>
                <syn-input label="UDP Receiver IP" 
                           placeholder="192.168.1.89" 
                           formControlName="udp_receiver_ip"
                           ngDefaultControl
                           size="small"
                           [helpText]="form.get('udp_receiver_ip')?.invalid && form.get('udp_receiver_ip')?.touched ? 'Invalid IP' : ''">
                </syn-input>
              </div>
              <syn-input label="UDP Port" 
                         type="number" 
                         formControlName="udp_port"
                         ngDefaultControl
                         size="small"
                         [helpText]="form.get('udp_port')?.invalid && form.get('udp_port')?.touched ? 'Range 1-65535' : ''">
              </syn-input>
            </div>

            <!-- Pipeline -->
            <syn-select label="Processing Pipeline" 
                        [value]="form.get('pipeline_name')?.value"
                        (syn-change)="form.get('pipeline_name')?.setValue($any($event.target).value)"
                        size="small"
                        ngDefaultControl>
              <syn-option value="">none</syn-option>
              <syn-option *ngFor="let p of pipelines()" [value]="p">{{ p }}</syn-option>
            </syn-select>

            <!-- Sim Mode Params -->
            <syn-input *ngIf="form.get('mode')?.value === 'sim'" 
                       label="PCD File Path" 
                       placeholder="./data/scan.pcd" 
                       formControlName="pcd_path"
                       ngDefaultControl
                       class="animate-in slide-in-from-top-2 duration-300"
                       [helpText]="form.get('pcd_path')?.invalid && form.get('pcd_path')?.touched ? 'Path is required' : ''">
            </syn-input>
          </div>


          <!-- Spatial Transformation -->
          <div>
            <div class="grid grid-cols-3 gap-x-4 gap-y-6">
              <syn-input size="small" label="X (m)" type="number" formControlName="x" ngDefaultControl></syn-input>
              <syn-input size="small" label="Y (m)" type="number" formControlName="y" ngDefaultControl></syn-input>
              <syn-input size="small" label="Z (m)" type="number" formControlName="z" ngDefaultControl></syn-input>
              
              <syn-input size="small" label="Roll (°)" type="number" formControlName="roll" ngDefaultControl></syn-input>
              <syn-input size="small" label="Pitch (°)" type="number" formControlName="pitch" ngDefaultControl></syn-input>
              <syn-input size="small" label="Yaw (°)" type="number" formControlName="yaw" ngDefaultControl></syn-input>
            </div>
          </div>
  </div>

  <div class="pt-8 flex justify-end gap-3">
    <syn-button variant="outline" size="small" type="button" (click)="onCancel()">
      <syn-icon name="close"></syn-icon>
      Cancel
    </syn-button>
    <syn-button variant="filled" size="small" type="submit" [disabled]="form.invalid">
      <syn-icon name="save"></syn-icon>
      Save Configuration
    </syn-button>
  </div>
</form>
