<div class="flex flex-col w-full min-w-[420px]">
  <!-- Header Card -->
  <div
    class="flex items-start gap-4 mb-6 p-4 bg-syn-color-neutral-50 rounded-xl border border-syn-color-neutral-200 shadow-sm"
  >
    <div
      class="w-10 h-10 bg-white rounded-lg shadow-sm border border-syn-color-neutral-200 text-syn-color-primary-600 flex items-center justify-center shrink-0"
    >
      <syn-icon [attr.name]="definition()?.icon || 'settings'" class="text-xl"></syn-icon>
    </div>
    <div class="flex flex-col pt-0.5">
      <h2 class="text-sm font-bold text-syn-color-neutral-900 tracking-tight">
        {{ definition()?.display_name }}
      </h2>
      <p class="text-xs text-syn-color-neutral-500 leading-relaxed mt-1">
        {{ definition()?.description }}
      </p>
    </div>
  </div>

  <form [formGroup]="form" (ngSubmit)="onSave()" class="flex flex-col gap-5 text-sm">
    <!-- Header fields -->
    <div class="grid grid-cols-2 gap-4">
      <!-- Display Name -->
      <div class="col-span-2">
        <syn-input
          label="Display Name"
          formControlName="name"
          placeholder="e.g. My Sensor"
          [helpText]="'Friendly name for this node'"
          ngDefaultControl
        ></syn-input>
      </div>
    </div>

    <syn-divider class="my-0"></syn-divider>

    <!-- Dynamic Properties from Schema -->
    <div class="grid grid-cols-2 gap-x-4 gap-y-3" [formGroup]="configForm">
      @for (prop of definition()?.properties; track prop.name) {
        <div
          class="flex flex-col"
          [class.col-span-2]="prop.type === 'vec3' || prop.type === 'string'"
        >
          <!-- String -->
          @if (prop.type === 'string') {
            <syn-input
              [label]="prop.label"
              [formControlName]="prop.name"
              [helpText]="prop.help_text || ''"
              ngDefaultControl
            ></syn-input>
          }

          <!-- Number -->
          @if (prop.type === 'number') {
            <syn-input
              [label]="prop.label"
              type="number"
              [step]="prop.step || 1"
              [attr.min]="prop.min"
              [attr.max]="prop.max"
              [formControlName]="prop.name"
              [helpText]="prop.help_text || ''"
              ngDefaultControl
            ></syn-input>
          }

          <!-- Boolean -->
          @if (prop.type === 'boolean') {
            <syn-checkbox
              [checked]="configForm.get(prop.name)?.value"
              (syn-change)="onCheckboxChange(prop.name, $event)"
              class="mt-6"
            >
              <span class="text-sm font-medium text-syn-color-neutral-700">{{ prop.label }}</span>
            </syn-checkbox>
            @if (prop.help_text) {
              <p class="text-[11px] text-syn-color-neutral-500 ml-7 mt-0.5">{{ prop.help_text }}</p>
            }
          }

          <!-- Select -->
          @if (prop.type === 'select') {
            <syn-select
              [label]="prop.label"
              [value]="configForm.get(prop.name)?.value"
              [helpText]="prop.help_text || ''"
              (syn-change)="onSelectChange(prop.name, $event)"
            >
              @for (opt of prop.options; track opt.value) {
                <syn-option [value]="opt.value">{{ opt.label }}</syn-option>
              }
            </syn-select>
          }

          <!-- Vec3 (X / Y / Z) -->
          @if (prop.type === 'vec3') {
            <div
              class="flex flex-col gap-2 p-3 bg-syn-color-neutral-50/50 rounded-lg border border-syn-color-neutral-200 mt-1"
            >
              <div class="flex flex-col">
                <label class="text-xs font-bold text-syn-color-neutral-900">{{ prop.label }}</label>
                @if (prop.help_text) {
                  <span class="text-[11px] text-syn-color-neutral-500 mt-0.5">{{
                    prop.help_text
                  }}</span>
                }
              </div>
              <div class="grid grid-cols-3 gap-2" [formGroupName]="prop.name">
                <syn-input
                  type="number"
                  [step]="0.1"
                  formControlName="0"
                  placeholder="X"
                  ngDefaultControl
                  size="small"
                >
                  <span slot="prefix" class="text-xs font-bold text-syn-color-neutral-400 pl-2"
                    >X</span
                  >
                </syn-input>
                <syn-input
                  type="number"
                  [step]="0.1"
                  formControlName="1"
                  placeholder="Y"
                  ngDefaultControl
                  size="small"
                >
                  <span slot="prefix" class="text-xs font-bold text-syn-color-neutral-400 pl-2"
                    >Y</span
                  >
                </syn-input>
                <syn-input
                  type="number"
                  [step]="0.1"
                  formControlName="2"
                  placeholder="Z"
                  ngDefaultControl
                  size="small"
                >
                  <span slot="prefix" class="text-xs font-bold text-syn-color-neutral-400 pl-2"
                    >Z</span
                  >
                </syn-input>
              </div>
            </div>
          }
        </div>
      }
    </div>

    <!-- Actions -->
    <div class="flex justify-end gap-3 mt-6 pt-5 border-t border-syn-color-neutral-200">
      <syn-button variant="outline" (click)="onCancel()" class="w-full sm:w-auto">
        <syn-icon name="cancel"></syn-icon>
        Cancel
      </syn-button>
      <syn-button
        variant="filled"
        type="submit"
        [disabled]="form.invalid || configForm.invalid || isSaving()"
        class="w-full sm:w-auto"
      >
        <syn-icon name="save"></syn-icon>
        Save
      </syn-button>
    </div>
  </form>
</div>
