<div class="h-full flex flex-col">
  <!-- Toolbar -->
  <div class="bg-white rounded-lg border border-syn-color-neutral-200 p-4 mb-4">
    <div class="flex items-center justify-between gap-4">
      <!-- Search Bar -->
      <syn-input
        type="search"
        placeholder="Search recordings by name, topic, or sensor..."
        size="medium"
        [value]="searchQuery()"
        (input)="searchQuery.set($any($event.target).value)"
        class="flex-1 max-w-md"
      >
        <syn-icon slot="prefix" name="search"></syn-icon>
      </syn-input>

      <!-- Actions -->
      <syn-button
        variant="outline"
        size="medium"
        (click)="refreshRecordings()"
        [disabled]="isLoading()"
      >
        <syn-icon slot="prefix" name="refresh"></syn-icon>
        Refresh
      </syn-button>
    </div>
  </div>

  <!-- Content -->
  <div class="flex-1 overflow-auto">
    @if (isLoading()) {
      <div class="flex items-center justify-center h-64">
        <syn-spinner></syn-spinner>
      </div>
    } @else if (sortedRecordings().length === 0) {
      <div class="flex flex-col items-center justify-center h-64 text-center">
        <syn-icon name="video_library" class="text-6xl text-syn-color-neutral-400 mb-4"></syn-icon>
        <h3 class="text-lg font-semibold text-syn-color-neutral-700 mb-2">No Recordings Found</h3>
        <p class="text-sm text-syn-color-neutral-600">
          @if (searchQuery()) {
            Try adjusting your search query
          } @else {
            Start recording from the Settings page to create your first recording
          }
        </p>
      </div>
    } @else {
      <!-- Recordings Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        @for (recording of sortedRecordings(); track recording.id) {
          <div
            class="bg-white rounded-lg border border-syn-color-neutral-200 hover:border-syn-color-primary-300 hover:shadow-md hover:-translate-y-0.5 transition-all duration-200 cursor-pointer overflow-hidden flex flex-col"
            (click)="selectRecording(recording)"
          >
            <!-- Thumbnail -->
            <div class="relative w-full h-48 bg-[#2a2a2b] flex items-center justify-center overflow-hidden">
              @if (recording.thumbnail_path) {
                <img
                  [src]="'/api/v1/recordings/' + recording.id + '/thumbnail'"
                  [alt]="recording.name + ' thumbnail'"
                  class="w-full h-full object-contain"
                  loading="lazy"
                  (error)="onThumbnailError($event)"
                />
              } @else {
                <!-- Fallback icon -->
                <syn-icon name="videocam" class="text-6xl text-syn-color-neutral-600 opacity-50"></syn-icon>
              }
              
              <!-- Frame count badge overlay -->
              <syn-badge 
                variant="primary" 
                size="small" 
                pill 
                class="absolute top-2 right-2 shadow-lg"
              >
                {{ recording.frame_count }} frames
              </syn-badge>
            </div>

            <!-- Card Header -->
            <div class="p-4 border-b border-syn-color-neutral-100">
              <div class="flex items-start justify-between gap-2">
                <div class="flex-1 min-w-0">
                  <h3 class="font-semibold text-sm truncate mb-1" [title]="recording.name">
                    {{ recording.name }}
                  </h3>
                  <p
                    class="text-xs text-syn-color-neutral-600 font-mono truncate"
                    [title]="recording.topic"
                  >
                    {{ recording.topic }}
                  </p>
                </div>
              </div>
            </div>

            <!-- Card Body -->
            <div class="p-4 space-y-2 text-xs flex-1">
              <div class="flex justify-between">
                <span class="text-syn-color-neutral-600">Duration:</span>
                <span class="font-medium">{{ formatDuration(recording.duration_seconds) }}</span>
              </div>

              <div class="flex justify-between">
                <span class="text-syn-color-neutral-600">File Size:</span>
                <span class="font-medium">{{ formatFileSize(recording.file_size_bytes) }}</span>
              </div>

              <div class="flex justify-between">
                <span class="text-syn-color-neutral-600">Created:</span>
                <span class="font-medium">{{ formatDate(recording.created_at) }}</span>
              </div>

              @if (recording?.metadata?.sensor_name) {
                <div class="flex justify-between">
                  <span class="text-syn-color-neutral-600">Sensor:</span>
                  <span
                    class="font-medium truncate max-w-[150px]"
                    [title]="recording.metadata.sensor_name"
                  >
                    {{ recording.metadata.sensor_name }}
                  </span>
                </div>
              }

              @if (recording?.metadata?.mode) {
                <div class="flex justify-between">
                  <span class="text-syn-color-neutral-600">Mode:</span>
                  <syn-badge
                    [variant]="recording.metadata.mode === 'real' ? 'success' : 'neutral'"
                    size="small"
                  >
                    {{ recording.metadata.mode === 'real' ? 'Hardware' : 'Simulation' }}
                  </syn-badge>
                </div>
              }
            </div>

            <!-- Card Actions -->
            <div
              class="p-3 bg-syn-color-neutral-50 border-t border-syn-color-neutral-100 flex gap-2"
            >
              <syn-button
                variant="filled"
                color="primary"
                size="small"
                (click)="loadForPlayback(recording); $event.stopPropagation()"
                class="flex-1"
              >
                <syn-icon slot="prefix" name="play_circle"></syn-icon>
                View
              </syn-button>

              <syn-button
                variant="outline"
                size="small"
                (click)="downloadRecording(recording); $event.stopPropagation()"
              >
                <syn-icon name="download"></syn-icon>
              </syn-button>

              <syn-button
                variant="outline"
                color="danger"
                size="small"
                style="color: var(--syn-color-error-700)"
                (click)="confirmDelete(recording); $event.stopPropagation()"
              >
                <syn-icon style="color: var(--syn-color-error-700)" name="delete"></syn-icon>
              </syn-button>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>

<!-- Delete Confirmation Dialog -->
@if (showDeleteDialog()) {
  <syn-dialog open (syn-request-close)="cancelDelete()">
    <span slot="label">Delete Recording</span>

    <p class="text-sm">
      Are you sure you want to delete <strong>{{ recordingToDelete()?.name }}</strong
      >? This action cannot be undone.
    </p>

    <syn-button slot="footer" variant="text" (click)="cancelDelete()" [disabled]="isDeleting()">
      Cancel
    </syn-button>
    <syn-button
      slot="footer"
      variant="filled"
      color="danger"
      style="color: var(--syn-color-error-700); font-size: var(--syn-font-size-x-large)"
      (click)="deleteRecording()"
      [disabled]="isDeleting()"
    >
      @if (isDeleting()) {
        <syn-spinner slot="prefix" size="small"></syn-spinner>
      }
      Delete
    </syn-button>
  </syn-dialog>
}

<!-- Details Panel (Future Enhancement) -->
@if (selectedRecording()) {
  <!-- Could add a detailed side panel or modal here -->
}
